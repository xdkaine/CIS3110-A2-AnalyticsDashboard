<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banana Farm Analytics Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand d-flex flex-column align-items-start" href="#">
                <span class="fs-5 fw-bold"><i class="bi bi-bar-chart-fill me-2"></i>Banana Farm Analytics Dashboard</span>
                <small class="text-secondary" style="font-size: 0.75rem;">Comprehensive analysis of banana farming operations</small>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://xdkaine.github.io/CIS3110-A1-JournalExposition/" target="_blank">
                            <i class="bi bi-building me-1"></i> Banana Republic Farms
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/xdkaine" target="_blank">
                            <i class="bi bi-github me-1"></i> GitHub
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.linkedin.com/in/thomasphao/" target="_blank">
                            <i class="bi bi-linkedin me-1"></i> LinkedIn
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Remove or comment out the header-area since we've moved its content to the navbar -->
    <!-- <div class="header-area">
        <div class="container">
            <h1 class="mb-2 fw-bold" data-aos="fade-right">E-Commerce Analytics Dashboard</h1>
            <p class="text-secondary mb-0" data-aos="fade-right" data-aos-delay="100">Comprehensive analysis of e-commerce performance metrics</p>
        </div>
    </div> -->

    <div class="container mt-4">
        <!-- Key Metrics Row - 4 equal columns -->
        <div class="row mb-4">
            <div class="col-md-3" data-aos="fade-up" data-aos-delay="0">
                <div class="card metrics-card">
                    <div class="icon"><i class="bi bi-currency-dollar"></i></div>
                    <div class="metrics-value" id="metric-revenue">$0</div>
                    <div class="metrics-label">Total Revenue</div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-delay="100">
                <div class="card metrics-card">
                    <div class="icon"><i class="bi bi-basket"></i></div>
                    <div class="metrics-value" id="metric-orders">0</div>
                    <div class="metrics-label">Total Production (kg)</div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-delay="200">
                <div class="card metrics-card">
                    <div class="icon"><i class="bi bi-tag"></i></div>
                    <div class="metrics-value" id="metric-aov">$0</div>
                    <div class="metrics-label">Average Price per kg</div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
                <div class="card metrics-card">
                    <div class="icon"><i class="bi bi-graph-up-arrow"></i></div>
                    <div class="metrics-value" id="metric-growth">0%</div>
                    <div class="metrics-label">YoY Growth</div>
                </div>
            </div>
        </div>

        <h4 class="section-title" data-aos="fade-right">Production Trends</h4>
        
        <!-- First Row - One big chart (12 columns) -->
        <div class="row">
            <div class="col-md-12" data-aos="zoom-in">
                <div class="card pulse-animation">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-line-chart"></i>Monthly Banana Production (12 Months)</h5>
                        <div class="chart-container chart-appear">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="section-title" data-aos="fade-right">Banana Varieties</h4>

        <!-- Second Row - Two charts (8 columns + 4 columns) -->
        <div class="row">
            <div class="col-md-8" data-aos="fade-right" data-aos-delay="100">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-bar-chart"></i>Banana Variety Performance</h5>
                        <div class="chart-container chart-appear">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-left" data-aos-delay="200">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-pie-chart"></i>Distribution Channels</h5>
                        <div class="chart-container chart-appear">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="section-title" data-aos="fade-right">Market Intelligence</h4>

        <!-- Third Row - Two charts (4 columns + 8 columns) -->
        <div class="row">
            <div class="col-md-4" data-aos="fade-right" data-aos-delay="100">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-people"></i>Consumer Demographics</h5>
                        <div class="chart-container chart-appear">
                            <canvas id="demographicsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8" data-aos="fade-left" data-aos-delay="200">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-bullseye"></i>Promotion Campaign ROI</h5>
                        <div class="chart-container chart-appear">
                            <canvas id="campaignChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-5 mb-3 text-center text-secondary">
            <p class="mb-1">Banana Farm Analytics Dashboard <i class="bi bi-code-slash mx-1"></i> CIS3110 Assignment</p>
            <p class="small mb-0">Built with <i class="bi bi-heart-fill text-danger"></i> using Bootstrap 5 & Chart.js</p>
        </footer>
    </div>

    <!-- Add scripts at the end of the body -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // Initialize AOS animations
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 800,
                once: true
            });
            
            // Activate chart animations after a delay
            setTimeout(function() {
                document.querySelectorAll('.chart-appear').forEach(function(chart) {
                    chart.classList.add('active');
                });
            }, 500);
        });

        // Global Chart.js settings
        Chart.defaults.font.family = "'Segoe UI', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif";
        Chart.defaults.color = '#adb5bd';
        Chart.defaults.plugins.legend.labels.color = '#adb5bd';
        Chart.defaults.elements.line.borderWidth = 3;
        Chart.defaults.elements.point.radius = 4;
        Chart.defaults.elements.point.hoverRadius = 6;
        
        // Custom chart theme for dark mode
        const chartColors = {
            primary: '#3a86ff',
            secondary: '#ff006e',
            success: '#38b000',
            warning: '#ffbe0b',
            danger: '#ff5400',
            info: '#3a0ca3',
            background: 'rgba(18, 18, 18, 0.8)',
            gridLines: 'rgba(255, 255, 255, 0.05)'
        };
        
        // Function to format currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { 
                style: 'currency', 
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        // Function to format percentage
        function formatPercent(value) {
            return new Intl.NumberFormat('en-US', { 
                style: 'percent',
                minimumFractionDigits: 1,
                maximumFractionDigits: 1
            }).format(value/100);
        }

        // Function to format number with commas
        function formatNumber(value) {
            return new Intl.NumberFormat('en-US').format(value);
        }

        // Initialize all charts
        let revenueChart, categoryChart, trafficChart, demographicsChart, campaignChart;

        // Dashboard data store
        let dashboardData = {
            monthlyProduction: [],
            bananaVarieties: [],
            distributionChannels: [], 
            consumerDemographics: [],
            promotionCampaigns: []
        };

        // Load all datasets and then initialize charts
        function loadAllData() {
            // Show loading animation
            showLoading();

            const dataFiles = [
                { key: 'monthlyProduction', file: 'data/monthly_production.csv' },
                { key: 'bananaVarieties', file: 'data/banana_varieties.csv' },
                { key: 'distributionChannels', file: 'data/distribution_channels.csv' },
                { key: 'consumerDemographics', file: 'data/consumer_demographics.csv' },
                { key: 'promotionCampaigns', file: 'data/promotion_campaigns.csv' }
            ];

            const promises = dataFiles.map(item => {
                return new Promise((resolve, reject) => {
                    Papa.parse(item.file, {
                        download: true,
                        header: true,
                        complete: function(results) {
                            dashboardData[item.key] = results.data;
                            resolve();
                        },
                        error: function(error) {
                            console.error(`Error loading ${item.file}:`, error);
                            reject(error);
                        }
                    });
                });
            });

            Promise.all(promises)
                .then(() => {
                    // Hide loading animation
                    hideLoading();
                    
                    // Initialize dashboard
                    updateMetrics();
                    createRevenueChart();
                    createCategoryChart();
                    createTrafficChart();
                    createDemographicsChart();
                    createCampaignChart();
                    
                    // Add animated counter effect to metrics
                    animateCounters();
                })
                .catch(error => {
                    console.error("Error loading data:", error);
                    hideLoading();
                });
        }

        // Show loading animation
        function showLoading() {
            const loadingHtml = `
                <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                     background: rgba(0,0,0,0.7); z-index: 9999; display: flex; justify-content: center; 
                     align-items: center; backdrop-filter: blur(5px);">
                    <div class="text-center">
                        <div class="spinner-border text-light mb-3" style="width: 3rem; height: 3rem;" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-light">Loading dashboard data...</p>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', loadingHtml);
        }

        // Hide loading animation
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.opacity = '0';
                overlay.style.transition = 'opacity 0.5s ease';
                setTimeout(() => overlay.remove(), 500);
            }
        }

        // Animate counters for metrics
        function animateCounters() {
            const elements = [
                { id: 'metric-revenue', prefix: '$', value: parseFloat(document.getElementById('metric-revenue').textContent.replace(/[^0-9.-]+/g, '')) },
                { id: 'metric-orders', prefix: '', value: parseInt(document.getElementById('metric-orders').textContent.replace(/[^0-9.-]+/g, '')) },
                { id: 'metric-aov', prefix: '$', value: parseFloat(document.getElementById('metric-aov').textContent.replace(/[^0-9.-]+/g, '')) },
                { id: 'metric-growth', prefix: '', suffix: '%', value: parseFloat(document.getElementById('metric-growth').textContent) }
            ];

            elements.forEach(item => {
                const element = document.getElementById(item.id);
                const originalText = element.textContent;
                element.textContent = item.prefix + '0' + (item.suffix || '');
                
                let start = 0;
                const duration = 1500;
                const startTime = performance.now();
                
                function updateCounter(timestamp) {
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function for smoother animation
                    const easeOut = t => 1 - Math.pow(1 - t, 3);
                    const easedProgress = easeOut(progress);
                    
                    const currentValue = Math.floor(item.value * easedProgress);
                    
                    if (item.id === 'metric-revenue' || item.id === 'metric-aov') {
                        element.textContent = formatCurrency(currentValue);
                    } else if (item.id === 'metric-orders') {
                        element.textContent = formatNumber(currentValue);
                    } else {
                        element.textContent = currentValue.toFixed(1) + '%';
                    }
                    
                    if (progress < 1) {
                        requestAnimationFrame(updateCounter);
                    }
                }
                
                requestAnimationFrame(updateCounter);
            });
        }

        // Update key metrics at the top of the dashboard
        function updateMetrics() {
            // Calculate total revenue from all production
            const totalRevenue = dashboardData.monthlyProduction.reduce((sum, month) => 
                sum + parseFloat(month.Revenue || 0), 0);
            
            // Calculate total banana production
            const totalProduction = dashboardData.monthlyProduction.reduce((sum, month) => 
                sum + parseFloat(month.Production_kg || 0), 0);
            
            // Calculate average price per kg
            const avgPrice = totalRevenue / totalProduction;
            
            // Calculate YoY growth (average from banana varieties)
            const avgGrowth = dashboardData.bananaVarieties.reduce((sum, variety) => 
                sum + parseFloat(variety.YoYGrowth || 0), 0) / dashboardData.bananaVarieties.length;
            
            // Update the metrics display
            document.getElementById('metric-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('metric-orders').textContent = formatNumber(totalProduction);
            document.getElementById('metric-aov').textContent = formatCurrency(avgPrice);
            document.getElementById('metric-growth').textContent = (avgGrowth * 100).toFixed(1) + '%';
        }

        // CHART 1: Line Chart for Monthly Production
        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Create gradient for background
            const gradientFill = ctx.createLinearGradient(0, 0, 0, 300);
            gradientFill.addColorStop(0, 'rgba(58, 134, 255, 0.3)');
            gradientFill.addColorStop(1, 'rgba(58, 134, 255, 0)');
            
            // Prepare data
            const labels = dashboardData.monthlyProduction.map(item => item.Month);
            const production = dashboardData.monthlyProduction.map(item => parseFloat(item.Production_kg));
            const revenue = dashboardData.monthlyProduction.map(item => parseFloat(item.Revenue));
            
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Production (kg)',
                            data: production,
                            borderColor: chartColors.primary,
                            backgroundColor: gradientFill,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: chartColors.primary,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: chartColors.primary,
                            pointHoverBorderWidth: 3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Revenue ($)',
                            data: revenue,
                            borderColor: chartColors.secondary,
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            tension: 0.4,
                            pointBackgroundColor: chartColors.secondary,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: chartColors.secondary,
                            pointHoverBorderWidth: 3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#f8f9fa',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            boxPadding: 6,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label === 'Revenue ($)') {
                                        return label + ': ' + formatCurrency(context.parsed.y);
                                    } else {
                                        return label + ': ' + formatNumber(context.parsed.y);
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#adb5bd',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Production (kg)',
                                color: '#adb5bd'
                            },
                            grid: {
                                color: chartColors.gridLines
                            },
                            ticks: {
                                color: '#adb5bd',
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Revenue ($)',
                                color: '#adb5bd'
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: chartColors.gridLines
                            },
                            ticks: {
                                color: '#adb5bd',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // CHART 2: Horizontal Bar Chart for Banana Varieties
        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            // Sort data by revenue (descending)
            const sortedData = [...dashboardData.bananaVarieties].sort((a, b) => 
                parseFloat(b.Revenue) - parseFloat(a.Revenue));
            
            // Prepare data
            const labels = sortedData.map(item => item.Variety);
            const revenue = sortedData.map(item => parseFloat(item.Revenue));
            const growth = sortedData.map(item => parseFloat(item.YoYGrowth) * 100); // Convert to percent
            
            // Generate background colors based on growth (green for positive, red for negative)
            const backgroundColors = growth.map(value => 
                value >= 0 ? `rgba(56, 176, 0, ${0.5 + value/30})` : `rgba(255, 84, 0, ${0.5 + Math.abs(value)/30})`);
            
            categoryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Revenue',
                        data: revenue,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace(/, .*\)/, ', 1)')),
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        delay: function(context) {
                            return context.dataIndex * 100;
                        },
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#f8f9fa',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    let value = context.parsed.x;
                                    let index = context.dataIndex;
                                    return [
                                        label + ': ' + formatCurrency(value),
                                        'Growth: ' + growth[index].toFixed(1) + '%',
                                        'Production: ' + formatNumber(sortedData[index].Production_Tons) + ' tons'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: chartColors.gridLines
                            },
                            ticks: {
                                color: '#adb5bd',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#adb5bd',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        }

        // CHART 3: Pie Chart for Distribution Channels
        function createTrafficChart() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            // Prepare data
            const labels = dashboardData.distributionChannels.map(item => item.Channel);
            const volumes = dashboardData.distributionChannels.map(item => parseInt(item.Volume_Tons));
            
            // Generate colors
            const colors = [
                'rgba(58, 134, 255, 0.8)',
                'rgba(56, 176, 0, 0.8)',
                'rgba(255, 190, 11, 0.8)',
                'rgba(255, 84, 0, 0.8)',
                'rgba(255, 0, 110, 0.8)',
                'rgba(58, 12, 163, 0.8)',
                'rgba(78, 149, 255, 0.8)',
                'rgba(149, 149, 149, 0.8)'
            ];
            
            trafficChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: volumes,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace(/, .*\)/, ', 1)')),
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 10,
                                padding: 15,
                                font: {
                                    size: 10
                                },
                                color: '#adb5bd'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18,.9)',
                            titleColor: '#fff',
                            bodyColor: '#f8f9fa',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.parsed;
                                    let sum = context.dataset.data.reduce((a, b) => a + b, 0);
                                    let percentage = Math.round(value * 1000 / sum) / 10;
                                    let index = context.dataIndex;
                                    let channel = dashboardData.distributionChannels[index];
                                    return [
                                        label + ': ' + value + ' tons (' + percentage + '%)',
                                        'Revenue: ' + formatCurrency(channel.Revenue),
                                        'Spoilage: ' + (parseFloat(channel.SpoilageRate) * 100).toFixed(1) + '%'
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // CHART 4: Radar Chart for Consumer Demographics
        function createDemographicsChart() {
            const ctx = document.getElementById('demographicsChart').getContext('2d');
            
            // Filter and organize data
            const ageGroups = [...new Set(dashboardData.consumerDemographics.map(item => item.AgeGroup))];
            
            // Filter male and female data
            const maleData = dashboardData.consumerDemographics.filter(item => item.Gender === 'Male');
            const femaleData = dashboardData.consumerDemographics.filter(item => item.Gender === 'Female');
            
            // Extract bananas per week consumption
            const maleConsumption = maleData.map(item => parseFloat(item.BananasPerWeek));
            const femaleConsumption = femaleData.map(item => parseFloat(item.BananasPerWeek));
            
            demographicsChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ageGroups,
                    datasets: [
                        {
                            label: 'Male',
                            data: maleConsumption,
                            backgroundColor: 'rgba(58, 134, 255, 0.2)',
                            borderColor: 'rgba(58, 134, 255, 1)',
                            pointBackgroundColor: 'rgba(58, 134, 255, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(58, 134, 255, 1)',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Female',
                            data: femaleConsumption,
                            backgroundColor: 'rgba(255, 0, 110, 0.2)',
                            borderColor: 'rgba(255, 0, 110, 1)',
                            pointBackgroundColor: 'rgba(255, 0, 110, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(255, 0, 110, 1)',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        r: {
                            pointLabels: {
                                color: '#adb5bd',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 4,
                            ticks: {
                                color: '#adb5bd',
                                backdropColor: 'transparent',
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                color: '#adb5bd'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#f8f9fa',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    let value = context.raw;
                                    let index = context.dataIndex;
                                    let demographic = dashboardData.consumerDemographics.find(
                                        item => item.AgeGroup === ageGroups[index] && item.Gender === label
                                    );
                                    return [
                                        label + ': ' + value + ' bananas/week',
                                        'Consumers: ' + formatNumber(demographic.ConsumerCount),
                                        'Preferred Ripeness: ' + parseFloat(demographic.PreferredRipeness).toFixed(1) + '/5'
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // CHART 5: Bubble Chart for Promotion Campaigns
        function createCampaignChart() {
            const ctx = document.getElementById('campaignChart').getContext('2d');
            
            // Prepare data
            const campaigns = dashboardData.promotionCampaigns.map(item => item.Campaign);
            
            // Group campaigns by type
            const campaignTypes = [...new Set(dashboardData.promotionCampaigns.map(item => item.Type))];
            
            // Create a dataset for each campaign type
            const datasets = campaignTypes.map((type, index) => {
                const typeData = dashboardData.promotionCampaigns
                    .filter(item => item.Type === type)
                    .map(item => {
                        return {
                            x: parseFloat(item.Spend),
                            y: parseFloat(item.RevenueImpact),
                            r: parseFloat(item.ROI_Percent) / 5,
                            campaign: item.Campaign,
                            roi: parseFloat(item.ROI_Percent),
                            acquisitionCost: parseFloat(item.AcquisitionCost),
                            newConsumers: parseInt(item.NewConsumers)
                        };
                    });
                
                // Colors for different campaign types
                const colors = [
                    'rgba(58, 134, 255, 0.7)',
                    'rgba(56, 176, 0, 0.7)',
                    'rgba(255, 190, 11, 0.7)',
                    'rgba(255, 84, 0, 0.7)',
                    'rgba(255, 0, 110, 0.7)',
                    'rgba(58, 12, 163, 0.7)'
                ];
                
                return {
                    label: type,
                    data: typeData,
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace(/, .*\)/, ', 1)'),
                    borderWidth: 1
                };
            });
            
            campaignChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        x: {
                            grid: {
                                color: chartColors.gridLines
                            },
                            title: {
                                display: true,
                                text: 'Campaign Spend',
                                color: '#adb5bd'
                            },
                            ticks: {
                                color: '#adb5bd',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: chartColors.gridLines
                            },
                            title: {
                                display: true,
                                text: 'Revenue Impact',
                                color: '#adb5bd'
                            },
                            ticks: {
                                color: '#adb5bd',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                color: '#adb5bd'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#f8f9fa',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            boxPadding: 6,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    const data = context.raw;
                                    return [
                                        data.campaign,
                                        'Type: ' + context.dataset.label,
                                        'Spend: ' + formatCurrency(data.x),
                                        'Revenue Impact: ' + formatCurrency(data.y),
                                        'ROI: ' + data.roi.toFixed(1) + '%',
                                        'New Consumers: ' + formatNumber(data.newConsumers),
                                        'Acquisition Cost: ' + formatCurrency(data.acquisitionCost)
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });
    </script>
</body>
</html>
